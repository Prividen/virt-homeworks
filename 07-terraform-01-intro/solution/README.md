# Домашняя работа по занятию "7.1. Инфраструктура как код"

> 1. Через час совещание на котором менеджер расскажет о новом проекте. Начать работу над которым надо 
будет уже сегодня. 
На данный момент известно, что это будет сервис, который ваша компания будет предоставлять внешним заказчикам.
Первое время, скорее всего, будет один внешний клиент, со временем внешних клиентов станет больше.  
>Так же по разговорам в компании есть вероятность, что техническое задание еще не четкое, что приведет к большому
количеству небольших релизов, тестирований интеграций, откатов, доработок, то есть скучно не будет.  
   
> Вам, как девопс инженеру, будет необходимо принять решение об инструментах для организации инфраструктуры.
> 
>...
> 1. Ответить на четыре вопроса представленных в разделе "Легенда". 
> 1. Какие инструменты из уже используемых вы хотели бы использовать для нового проекта?
   
Вопрос выбора инструментов зависит от требуемых под проект ресурсов, его планируемой архитектуры, и наших возможностей (денег, времени, доступных специалистов) 
- это социальная сеть из статыщь микросервисов? тогда без контейнеров-оркестрации не обойтись.
- это сервис вебкамочек с толстыми сетевыми каналами и большим архивом? придётся наверное делать CEPH-хранилище, а о публичных облаках забыть, особенности контента.
- это VDI с Виндусом и CADом? где придётся брать виртуализацию/Horizon, засовывать туда GPU, а Кубернетесу вроде и делать нечего. 
- это VPN-сервис, по серверу на каждый континент? И без Терраформа обойдёмся.

А так же:
- есть у нас бюджет на лицензии и подписки? Может, нам для лёгкости деплоя по миру нужно взять 
  GitLab Premium c geo-модулем, а для стремительности проекта, не будем связываться с Кубернетесом 
  а возьмём OpenShift, где многое уже из коробки? 
- Можем ли мы набирать в команду профильных инженеров с отсутствующими у нас компетенциями?
- Можем ли мы пользоваться публичными сервисами, или это по политическим мотивам должно быть on-premises решение?
- А какой клиенту нужен SLA? 
  
Исходя из общих соображений, если приступить к проекту надо уже сегодня, то клиент через неделю 
уже будет требовать PoC, и первый релиз к концу месяца. Т.е. разработка будет вестись в великой спешке, 
всеми имеющимися инструментами и средствами, дающими немедленный результат. И баш-скрипты пригодятся для 
прототипирования. В дальнейшем, с устаканиванием архитектуры проекта, когда его развитие будет носить эволюционный 
характер - оформление инфраструктуры проекта в виде кода (IaaC) и выстраиванием правильных процессов CI/CD - размещение всего кода в репозитариях, 
автоматизацию сборки образов-шаблонов, покрытие тестами, стратегии деплоя, обеспечение откатов, масштабирование/отказоустойчивость и безопасность.    

> - Какой тип инфраструктуры будем использовать для этого проекта: изменяемый или не изменяемый?

В начале разработки, когда вопросы масштабирования и надёжности пока не важны, зато проект постоянно 
изменяется, на лету меняются какие-то концепции, ставятся эксперименты, выглядит предпочтительным выбрать 
изменяемый тип инфраструктуры. С последующим переходом на неизменяемую, для повышения надёжности-предсказуемости.

> - Будет ли центральный сервер для управления инфраструктурой?

Центральный сервер управления инфраструктурой вряд ли стоит делать с самого начала, чтоб не оттягивать на него ресурсы. 
Вполне можно попробовать обойтись инструментами, не требующими его (Ansible, Terraform). 
А далее - по потребности, может, клиент именно такой сервер и хочет, чтобы сразу видеть всю инфраструктуру проекта в одном месте.   

> - Будут ли агенты на серверах?

Будут ли агенты на серверах, зависит от выбранных инструментов. Ansible/Terraform не потребуют. Для заббикса-прометеуса 
чего-нибудь придётся поставить. Интересно, считать ли vmware tools за агент?..

> - Будут ли использованы средства для управления конфигурацией или инициализации ресурсов? 

Использование средств управления конфигурацией/инициализации ресурсов - тоже зависит от проекта. 
Если мы поселились в публичном AWS, и наш сервис требует кучи инстансов, Терраформ будет очень кстати. 
Если у нас используются пара физических серверов, мы можем с удовольствием деплоить их Ансиблем, а Терраформ не пригодится.
Если у нас всё живёт в виртуалках, мы делаем их шаблоны packer'ом, а Ансибль нам вроде и не к чему.

> - Хотите ли рассмотреть возможность внедрения новых инструментов для этого проекта? 

Скорее всего пригодятся и новые инструменты. Vagrant для разработки-тестирования, Vault для секретов-токенов-сертификатов, 
Prometheus для мониторинга-метрик, Elasticsearch для логов. 

---
> 2. Установите терраформ при помощи менеджера пакетов используемого в вашей операционной системе.
В виде результата этой задачи приложите вывод команды `terraform --version`.

```
root@test-xu20:~# terraform --version
Terraform v1.0.3
on linux_amd64
```

---
> В какой-то момент вы обновили терраформ до новой версии, например с 0.12 до 0.13. 
А код одного из проектов настолько устарел, что не может работать с версией 0.13. 
В связи с этим необходимо сделать так, чтобы вы могли одновременно использовать последнюю версию терраформа установленную при помощи
штатного менеджера пакетов и устаревшую версию 0.12.   
>
>В виде результата этой задачи приложите вывод `--version` двух версий терраформа доступных на вашем компьютере 
или виртуальной машине.

```
root@test-xu20:~# terraform --version; terraform-102 --version
Terraform v1.0.3
on linux_amd64
Terraform v1.0.2
on linux_amd64

Your version of Terraform is out of date! The latest version
is 1.0.3. You can update by downloading from https://www.terraform.io/downloads.html
```